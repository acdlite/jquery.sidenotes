(function(){var t=[].slice;(function(e,i,o){var s,n,r,h;e.fn.extend({sidenotes:function(){var i,o;o=arguments[0],i=2<=arguments.length?t.call(arguments,1):[];return this.each(function(){var t,s,n;t=e(this);s=(n=t.data("sidenotes"))!=null?n:t.data("sidenotes",new r(this,o));if(typeof o==="string"){s[o].apply(s,i);if(o==="destroy"){t.removeData("sidenotes")}}return true})}});r=function(){t.prototype.options={footnoteContainerSelector:".footnotes",footnoteSelector:"> ol > li",initiallyHidden:false,removeRefMarkRegex:/(?!)/,refMarkClass:"ref-mark",sidenoteClass:"sidenote",sidenoteGroupClass:"sidenote-group",sidenoteElement:"aside",sidenoteGroupElement:"div",sidenotePlacement:"before",hideFootnoteContainer:true,formatSidenote:function(t,i,o){var s;s=e("<"+this.sidenoteElement+"/>",{"class":this.sidenoteClass}).html(t).attr("id",i);if(o!=null){s.attr("data-ref",o);s.prepend(e("<span/>",{"class":this.refMarkClass}).html(o))}return s},formatSidenoteID:function(t){return t.replace(/^f/,"s")},hide:function(t){return t.hide()},show:function(t){return t.show()}};function t(t,i){var o,r;this.options=e.extend({},this.options,i);this.options.sidenotePlacement=this.options.placement||this.options.sidenotePlacement;if(this.options.hideFootnoteContainer){this.$footnoteContainer=e(this.options.footnoteContainerSelector,t)}this.$footnoteContainer=this.$footnoteContainer.size()!==0?this.$footnoteContainer:null;this.$postContainer=this.$footnoteContainer.parent();this.$footnotes=e(this.options.footnoteContainerSelector+" "+this.options.footnoteSelector,this.$postContainer);this.sidenotesAfterRef=this.options.sidenotePlacement==="after";r=1;this.sidenotes=[];this.groups=[];o=this;this.$footnotes.each(function(){var t,e,i,h,f,a,d;t=this;e=t.id;h=o.options.removeRefMarkRegex.test(e);a=new s(t,h?null:r++,o);o.sidenotes.push(a);f=(d=o.sidenotes[o.sidenotes.length-2])!=null?d:null;if(f!=null?f.$pivot.is(a.$pivot):void 0){if(f.hasGroup()){return f.group.push(a)}else{i=new n([f,a],o);return o.groups.push(i)}}});this.isHidden=this.options.initiallyHidden;if(this.isHidden){this.hide(true)}else{this.show(true)}}t.prototype.show=function(t){var e,i,o,s,n,r,h,f;if(this.isHidden||t){h=this.sidenotes;for(o=0,n=h.length;o<n;o++){i=h[o];if(t&&!i.hasGroup()){i.$pivot[this.sidenotePlacement()](i.$sidenote)}i.show()}f=this.groups;for(s=0,r=f.length;s<r;s++){e=f[s];if(t){e.$pivot[this.sidenotePlacement()](e.$group)}e.show()}if(this.$footnoteContainer!=null&&this.options.hideFootnoteContainer){this.options.hide(this.$footnoteContainer)}return this.isHidden=false}};t.prototype.hide=function(t){var e,i,o,s,n,r,h,f;if(!this.isHidden||t){h=this.sidenotes;for(o=0,n=h.length;o<n;o++){i=h[o];if(t&&!i.hasGroup()){i.$pivot[this.sidenotePlacement()](i.$sidenote)}i.hide()}f=this.groups;for(s=0,r=f.length;s<r;s++){e=f[s];if(t){e.$pivot[this.sidenotePlacement()](e.$group)}e.hide()}if(this.$footnoteContainer!=null){this.options.show(this.$footnoteContainer)}return this.isHidden=true}};t.prototype.sidenotePlacement=function(t,e){var i,o,s,n,r,h,f,a;if((t==="before"||t==="after")&&(t!==this.sidenotePlacement()||e)){f=this.sidenotes;for(s=0,r=f.length;s<r;s++){o=f[s];if(!o.hasGroup()){o.$pivot[t](o.$sidenote)}}a=this.groups;for(n=0,h=a.length;n<h;n++){i=a[n];i.$pivot[t](i.$group)}return this.sidenotesAfterRef=t==="after"}else{if(this.sidenotesAfterRef){return"after"}else{return"before"}}};t.prototype.placement=function(t,e){return this.sidenotePlacement(t,e)};t.prototype.destroy=function(){var t,e,i,o,s,n,r,h,f;this.hide();r=this.sidenotes;for(i=0,s=r.length;i<s;i++){e=r[i];e.$sidenote.remove()}h=this.groups;f=[];for(o=0,n=h.length;o<n;o++){t=h[o];f.push(t.$group.remove())}return f};return t}();s=function(){function t(t,i,o){var s,n,r,f,a,d;this.$footnote=e(t);this.owner=o;this.footnoteID=t.id;this.sidenoteID=this.owner.options.formatSidenoteID(this.footnoteID);this.ref=i>0?i:null;this.$refMarkAnchor=e("a[href='#"+h(this.footnoteID)+"']",this.owner.$postContainer);this.$refMarkSup=this.$refMarkAnchor.parent("sup");this.$refMarkSup=this.$refMarkSup.size()!==0?this.$refMarkSup:null;this.isNested=e.contains(this.owner.$footnoteContainer.get(0),this.refMark().get(0));if(this.isNested){n=this.refMark().closest(this.owner.$footnotes);d=this.owner.sidenotes;for(f=0,a=d.length;f<a;f++){r=d[f];if(r.$footnote.is(n)){this.referringSidenote=r;break}}}this.refMarkID=this.refMark().attr("id");this.originalRef=this.$refMarkAnchor.html();this.$sidenote=this.owner.options.formatSidenote(this.$footnote.html(),this.sidenoteID,this.ref);this.$pivot=!this.isNested?this.refMark().parentsUntil(this.owner.$postContainer).last():this.referringSidenote.$pivot;this.group=null;s=e("a[href='#"+h(this.refMarkID)+"']",this.$sidenote);if(s!=null&&this.noMark()){this.owner.options.hide(s)}this.owner.options.hide(this.$sidenote);this.isHidden=true}t.prototype.noMark=function(){return this.ref==null};t.prototype.hasGroup=function(){return this.group!=null};t.prototype.show=function(t){if(this.isHidden||t){if(this.noMark()){this.owner.options.hide(this.refMark())}else{this.$refMarkAnchor.html(this.ref);this.$refMarkAnchor.attr("href","#"+this.sidenoteID)}this.owner.options.show(this.$sidenote);this.owner.options.hide(this.$footnote);return this.isHidden=false}};t.prototype.hide=function(t){if(!this.isHidden||t){this.$refMarkAnchor.html(this.originalRef);this.$refMarkAnchor.attr("href","#"+this.footnoteID);this.owner.options.show(this.refMark());this.owner.options.hide(this.$sidenote);this.owner.options.show(this.$footnote);return this.isHidden=true}};t.prototype.refMark=function(){var t;return(t=this.$refMarkSup)!=null?t:this.$refMarkAnchor};return t}();n=function(){function t(t,i){var o;this.sidenotes=[];this.owner=i;this.$group=e("<"+this.owner.options.sidenoteGroupElement+"/>",{"class":this.owner.options.sidenoteGroupClass});this.push(t);this.$pivot=(o=this.sidenotes[0])!=null?o.$pivot:void 0;this.owner.options.hide(this.$group);this.isHidden=true}t.prototype.push=function(t){var e,i,o,s,n;i=t instanceof Array?t:[t];(n=this.sidenotes).push.apply(n,i);for(o=0,s=i.length;o<s;o++){e=i[o];this.$group.append(e.$sidenote);e.group=this}return this.$pivot!=null?this.$pivot:this.$pivot=this.sidenotes[0].pivot};t.prototype.show=function(){if(this.isHidden){this.owner.options.show(this.$group);return this.isHidden=false}};t.prototype.hide=function(){if(!this.isHidden){this.owner.options.hide(this.$group);return this.isHidden=true}};return t}();return h=function(t){return t.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")}})(jQuery,window,document)}).call(this);